#####################################################################
# Standard routine for finding $$feature
#
# source: $$filename 
#####################################################################
if test x$enabled_$$feature_esc = xyes
    then
    if test x$found_$$feature_esc = xno
	then
	found=1
	for file in $$headers{$$feature}
	  do
	  AC_CHECK_HEADER($file,[filefound=1],[filefound=0])
	  AC_MSG_CHECKING([$file for $$feature in standard locations])
	  if test $filefound = 1
	      then
	      AC_MSG_RESULT([yes])
	  else
	      AC_MSG_RESULT([no])
	      found=0
	  fi
	done
	AC_MSG_CHECKING([[$$feature header(s) found in standard locations]])
	if test $found = 1
	    then	
	    AC_MSG_RESULT([yes])
	    LIBS=
	    AC_CHECK_LIB($$libs{$$feature},$$function{$$feature},,,
		[$$other_libs{$$feature}])
	    AC_MSG_CHECKING([libs needed to link against $$feature])
	    if test x != x$LIBS
		then
		found_$$feature_esc=yes
		libs_$$feature_esc=`echo $LIBS $$other_libs{$$feature} |  sed -e 's/ -l/ /g' |  sed -e 's/^-l/ /g' | sed -e 's/^ //'`
		AC_MSG_RESULT([$libs_$$feature_esc])
	    else
		old_CXXFLAGS=$CXXFLAGS
		old_LDFLAGS=$LDFLAGS
		for tmp in $$headers{$$feature}
		  do
		  CXXFLAGS="$CXXFLAGS -I$tmp"
		done
		for tmp in $$libs{$$feature}
		  do
		  LDFLAGS="$LDFLAGS -l$tmp"
		done
		for tmp in $$other_libs{$$feature}
		  do
		  LDFLAGS="$LDFLAGS -l$tmp"
		done

		AC_MSG_CHECKING([compiling, linking and running with $$feature])
		AC_RUN_IFELSE(
		    [
			AC_LANG_SOURCE(
			    [[
				    $$source{$$feature}
				    ]])	
			],[
			AC_MSG_RESULT(ok)
			found_$$feature_esc=yes
			libs_$$feature_esc=`echo $$libs{$$feature} $$other_libs{$$feature} |  sed -e 's/ -l/ /g' |  sed -e 's/^-l/ /g' | sed -e 's/^ //'`
			],[
			AC_MSG_RESULT(failed)
			AC_MSG_RESULT([none found])
			found_$$feature_esc=no
		    ]
		)
		CXXFLAGS=$old_CXXFLAGS
		LDFLAGS=$old_LDFLAGS
		
	    fi
	else
	    AC_MSG_RESULT([no])
	    found_$$feature_esc=no
	fi
    fi
fi
