<html>
  <head>
    <title>How to set up your own programs using CLAM</title>
  </head>

  <body>
    <p>This directory provides the user with an example of using CLAM for
    her own programs. So it is ment to be copied somewhere out of CLAM
    dir tree and it will be ready to compile with a little adjustment
    in one file </p>

    <h1>How to set up your own programs using CLAM</h1>


    <p>This chapter is a little tutorial for setting up an example
    application using CLAM and its build system. In first place we're
    going to compile a given simple application --very straight. And
    in second place we're going to go through all possible
    customizations in the build settings that the user might need to
    set up more complicated projects.</p>
    
    <h2>An out-of-the-box example</h2>
    
    <p>Following this steps you'll get an application which performs
    an FFT of a random generated audio and stores its spectral
    equivalent in a file in XML</p>

    <ol>
      <li>Copy this directory structure
      (<tt>compiling_against_CLAM_example</tt>) somehere outside the
      CLAM dir tree. We recommend to place it just in the same level as the
      CLAM root. (in the same parent dir)
	<br />
      Note that this directory, apart from the .cxx file with a main
      function, contains a subdir named <tt>build/</tt> with the
      configuration files necessary to use the automatic CLAM build
	<br />
	<b>Hint:</b> in linux, cp -ar &lt;src&gt; &lt;dst&gt; copies a
	directory recursively
      </li>  

      <li>Edit the build/clam-location.cfg and change CLAM_PATH so it
      points to the CLAM dir --maybe you'll find that this value is
      already properly set.</li> 

      <li>At this point we  need to have srcdeps already
      compiled. How to do this is explained in this section [?] of the
      documentation.</li> 

      <li>Now our way forks depending on the choosed compiler 
	<ul>
	  <li><b>gcc</b>
	    <br />
	    Just call make with 'debug' or 'release' as argument:
	    <pre>$ make CONFIG=debug</pre>
	    This will generate the needed dependencies and compile the
	    program
	  </li>
	  <li><b>MS Visual 6</b>
	    <br />
	    The first time we'll need to generate the .dsp file. For
	    that we'll need to use the command line.
	    <ul>
	      <li>change your current dir to the <tt>buid</tt> subdir
	      of our example directory</li>
	      <li>from this dir execute the srcdeps --which is in the
	      <tt>CLAM/build/srcdeps</tt>  dir-- passing the
	      <tt>settings.cfg</tt> as argument. For example:  
		<pre>$ ../../CLAM/build/srcdeps/srcdeps settings.cfg</pre>
	      </li>

	      <li>srdeps generate a .dsp with the smallest subset of
	      the CLAM implementation files needed to compile the
	      example.</li> 

	      <li>further runs of srcdeps can be achieved directly
	      from the MS Visual IDE (compile settings.cfg). See more
	      details in [?]</li>
	    </ul>

	</ul>
      </li>
    </ol>
    <p>Hopefully we've been able to run the example and play with
    spectral data in XML. From here we'll see how to customize the
    build options and to create more complex projects</p>

    <h2>Customizing your project</h2>

    <p>Here we're going to go through the things you should know when
    setting your own project that compiles against CLAM and using its
    automatic build system.</p>
    <p>First of all, we assume that you allready have created a root
    directory for your project</p>


    <ul>
      <li>modify <b>clam_location.cfg</b> making the CLAM_PA
      <li>we recomend to create a <tt>buid/</tt> directory inside your
      project dir. There you're going to place all the configuration
      files that the build-system needs. There you must copy --from
      the <tt>compiling_against_clam_example</tt> dir-- the following
      files:
	<ul>
	  <li>clam-location.cfg</li>
	  <li>defaults.cfg</li>
	  <li>Makefile</li>
	  <li>Makefiles.rules</li>
	  <li>settings.cfg</li>
	  <li>system.cfg</li>
	</ul>
      </li>

      <li>maybe you'll like to organize your code starting from a
      <tt>src/</tt> directory. This is up to you but has to be taken
      in account when configuring the build files</li>

      <li>modify <b>clam_location.cfg</b> making the CLAM_PATH
      variable to point to the CLAM root directory. Either you can use
      an absolute or relative path.</li>

      <li>modify the TOP variable of <b>Makefile</b>. It must point to
      your project root dir. Its value should probably be just
      <tt>../</tt>  but is also feasible that you want to spread
      severals Makefiles in different subdirectories of
      <tt>build/</tt> thus the TOP variable must be defined accordingly.
      </li>
      <li><b>settings.cfg</b> is the most important file you'll need
      to tweek. Notice that if you want too build several executables
      you'll need to create a directory for each one containing both
      <tt>settings.cfg</tt> and <tt>Makefile</tt>.
	<br />
	What follows is a list of the settings.cfg variables you might
	need to modify. See [?] for more details.
	
	<ul>
	  <li>TOP: must point to your project root.</li>
	  <li>PROGRAM: the name of your binary --the executable.</li>
	  <li>various library flags: changing its value {0,1} you can
	  choose to link or not against several libraries (i.e. fltk,
	  fftw, xerces-c, etc)</li>
	  <li>PRJ_SEARCH_INCLUDES: the directories that contains your
	  headers. Notice that you don't have to add any CLAM
	  directory here.</li>
	  <li>PRJ_SEARCH_RECURSE_INCLUDES: the same as before but now
	  including all the recursive directory tree</li>

	  <li>SOURCES: all the entry points: the implementation files
	  (i.e. .cxx files) that you'll want to compile and can not be
	  automatically deduced. Write the source files relative to
	  the TOP. I.e.: <pre>SOURCES = $(TOP)/program_using_clam.cxx</pre>
	    <br />
	    Normally you'll only need to include
	  the implementation file that contains the <tt>main</tt>
	  function.</li> 

	  <li>Note: More info about how the CLAM automatic build
	  system works can be found in [?]</li>

	</ul>
	<p>Now we should be ready for a nice compilation !</p>
	<p>If we are using
	<b>gcc</b> just call <tt>make
	CONFIG=[debug|release]</tt> standing in the proper directory
	--where the settings.cfg and Makefile are. This will both generate the
	dependencies and will compile the project.
	</p>
	<p>
	  Otherwise, if you are stucked with <b>MS Visual</b> run the
	  CLAM srcdeps.exe application from your directory --where the
	  settings.cfg stands-- and you'll get a ready-to-use dsp
	  file.
	</p>

      </li>
      

    </ul>
    <p>
      That's it, hopefully you are compiling your project agains CLAM,
      without dealing in manualy finding the CLAM sources it needs.
    </p>
    <p>
      Remember to see the Build System chapter in CLAM documentation
      for further details.
    </p>

  </body>
</html>

